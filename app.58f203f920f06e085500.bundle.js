document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("search-todo"),e=document.querySelector(".add-list-btn"),n=document.querySelector(".add-task-btn"),o=document.querySelector(".task-content"),a=document.querySelector(".taskname h2"),s="https://678e0d58a64c82aeb11eca8f.mockapi.io/",c={today:[],stickyWall:[]},d=async(t="today")=>{try{const e=await fetch(`${s}tasks`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();c[t]=n.filter((e=>e.category===t)),i(t)}catch(t){console.error("Error fetching tasks:",t)}},i=(t="today")=>{t&&"string"==typeof t||console.error("Invalid category passed to renderTasks:",t),c[t]||(console.warn(`No tasks for category: ${t}. Defaulting to 'today'.`),t="today"),a.textContent=t.charAt(0).toUpperCase()+t.slice(1),o.innerHTML="",c[t].forEach((e=>{const n=document.createElement("div");n.classList.add("task-container");const a=document.createElement("div");a.classList.add("task-info");const s=document.createElement("h3");s.textContent=e.completed?`✔️ ${e.title}`:e.title,s.style.textDecoration=e.completed?"line-through":"none",a.appendChild(s);const c=document.createElement("p");c.textContent=e.description||"No description provided.",c.style.textDecoration=e.completed?"line-through":"none",c.classList.add("task-description"),a.appendChild(c);const d=document.createElement("span");d.classList.add("timestamp"),d.textContent=e.timestamp,a.appendChild(d),n.appendChild(a);const i=document.createElement("div");i.classList.add("task-actions");const m=document.createElement("button");m.textContent=e.completed?"Undo":"Complete",m.addEventListener("click",(()=>r(e.id,t))),i.appendChild(m);const h=document.createElement("button");h.textContent="Edit",h.addEventListener("click",(()=>l(e.id,t))),i.appendChild(h);const u=document.createElement("button");u.textContent="Delete",u.addEventListener("click",(()=>p(e.id,t))),i.appendChild(u),n.appendChild(i),o.appendChild(n)}))},r=async(t,e)=>{try{const n=c[e].find((e=>e.id===t));if(!n)return;await fetch(`${s}tasks/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:!n.completed})}),d(e)}catch(t){console.error("Error toggling task completion:",t)}},l=async(t,e)=>{const n=prompt("Edit task title:"),o=prompt("Edit task description:");if(n||o)try{await fetch(`${s}tasks/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:n,description:o})}),d(e)}catch(t){console.error("Error editing task:",t)}},p=async(t,e)=>{try{await fetch(`${s}tasks/${t}`,{method:"DELETE"}),d(e)}catch(t){console.error("Error deleting task:",t)}},m=async()=>{const t=prompt("Enter the list name:");if(t){const e={name:t};try{const t=await fetch(`${s}lists`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);h()}catch(t){console.error("Error adding new list:",t)}}},h=async()=>{try{const t=await fetch(`${s}lists`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();u(e)}catch(t){console.error("Error fetching lists:",t)}},u=(t=[])=>{const e=document.querySelector(".lists");e.innerHTML="<button class='add-list-btn'><img width='20' height='20' src='https://img.icons8.com/plumpy/20/plus-math.png' alt='plus-math'> Add List</button>",t.forEach((t=>{const n=document.createElement("div");n.classList.add("list-item"),n.textContent=t.name;const o=document.createElement("button");o.textContent="Delete",o.addEventListener("click",(()=>y(t.id))),n.appendChild(o),e.appendChild(n)})),document.querySelector(".add-list-btn").addEventListener("click",m)},y=async t=>{try{await fetch(`${s}lists/${t}`,{method:"DELETE"}),h()}catch(t){console.error("Error deleting list:",t)}};t&&t.addEventListener("input",(()=>{const e=t.value.toLowerCase(),n=c.today.filter((t=>t.title.toLowerCase().includes(e)));if(o.innerHTML="",c.today){if(0===n.length)return o.innerHTML="<p>No tasks match your search.</p>",void(a.textContent="Search Results");n.forEach((t=>{const e=document.createElement("div");e.classList.add("task-container");const n=document.createElement("div");n.classList.add("task-info");const a=document.createElement("h3");a.textContent=t.completed?`✔️ ${t.title}`:t.title,a.style.textDecoration=t.completed?"line-through":"none",n.appendChild(a);const s=document.createElement("p");s.textContent=t.description||"No description provided.",s.classList.add("task-description"),n.appendChild(s);const c=document.createElement("span");c.classList.add("timestamp"),c.textContent=t.timestamp,n.appendChild(c),e.appendChild(n);const d=document.createElement("div");d.classList.add("task-actions");const i=document.createElement("button");i.textContent=t.completed?"Undo":"Complete",i.addEventListener("click",(()=>r(t.id,"today"))),d.appendChild(i);const m=document.createElement("button");m.textContent="Edit",m.addEventListener("click",(()=>l(t.id,"today"))),d.appendChild(m);const h=document.createElement("button");h.textContent="Delete",h.addEventListener("click",(()=>p(t.id,"today"))),d.appendChild(h),e.appendChild(d),o.appendChild(e)})),a.textContent=e?"Search Results":"Today"}else o.innerHTML="<p>Tasks are loading. Please wait...</p>"})),"app"===document.body.dataset.page&&(document.querySelector(".today").addEventListener("click",(()=>d("today"))),document.querySelector(".stickywall").addEventListener("click",(()=>d("stickyWall"))),d("today"),h(),e.addEventListener("click",m),n.addEventListener("click",(()=>(async t=>{const e=prompt("Enter task title:"),n=prompt("Enter task description:");if(e){const o={title:e,description:n,category:t,timestamp:(new Date).toLocaleString(),completed:!1};await fetch(`${s}tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),d(t)}})("today"))))}));